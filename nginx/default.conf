server {
    listen 80; # √âcoute sur le port 80 interne, derri√®re Traefik
    server_name redcap.medicapp.icu;
    root /var/www/html;
    index index.php index.html;

    # Assurez-vous que REDCap g√®re le mode "pretty URL"
    location / {
        try_files $uri $uri/ /index.php?$args;
    }

    # Passe les requ√™tes PHP √† PHP-FPM
    location ~ \.php$ {
    # 1. V√©rifie que le fichier existe avant de le passer √† PHP (s√©curit√©)
    try_files $uri =404; 

    # 2. Transmission √† PHP-FPM
    fastcgi_pass php:9000;
    fastcgi_index index.php;
    
    # 3. Inclut le jeu de param√®tres FastCGI Nginx
    # (Ce fichier contient les directives fastcgi_param de base)
    include fastcgi_params;

    # 4. üîë CHEMIN CRITIQUE : Transmet le chemin absolu du script √† PHP-FPM
    # $document_root est /var/www/html/ et $fastcgi_script_name est le nom du fichier PHP
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_param PATH_INFO $fastcgi_path_info;
    
    # Param√®tres de temps d'attente pour √©viter le timeout (utile pour REDCap)
    fastcgi_read_timeout 300;
    fastcgi_connect_timeout 300;
}

    # Interdit l'acc√®s aux fichiers sensibles
    location ~ /\. {
        deny all;
    }
}